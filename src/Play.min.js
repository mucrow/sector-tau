SECTOR_TAU.Play=function(e){},SECTOR_TAU.Play.prototype={create:function(){this.game.input.gamepad.start(),this.pad=this.game.input.gamepad.pad1,this.game.physics.startSystem(Phaser.Physics.ARCADE),this.game.stage.backgroundColor="#000";var e=this.world.width,t=this.world.height,s=e/2,i=t/2;this.bakeMovements(),this.NUM_WAVES=14,this.ENEMY_SPACING=64,this.sfx={},this.sfx.damage1=this.game.add.sound("damage1.wav"),this.sfx.damage1.volume=2,this.sfx.destroy1=this.game.add.sound("destroy1.wav"),this.sfx.destroy1.volume=2,this.sfx.hullup=this.game.add.sound("hullup.wav"),this.sfx.scoreup=this.game.add.sound("scoreup.wav"),this.sfx.shot1=this.game.add.sound("shot1.wav"),this.sfx.shot1.volume=.5,this.sfx.shot2=this.game.add.sound("shot2.wav"),this.sfx.shot3=this.game.add.sound("shot3.wav"),this.sfx.shot3.volume=.85,this.sfx.scoreup.volume=.45,this.music={},this.music.boss=this.game.add.audio("boss.ogg"),this.music.waves1=this.game.add.audio("waves1.ogg"),this.music.waves2=this.game.add.audio("waves2.ogg"),this.music.win=this.game.add.audio("win.ogg"),this.music.current=this.music.waves1,this.player=this.createPlayer(s,t-64,"player1"),this.boss=null,this.wave=0,this.waveText=this.game.add.text(s,i,"OOPS",{fill:"#fff",font:FONT_TITLE,fontSize:72}),this.waveText.anchor.set(.5,.5),this.waveText.visible=!1,this.grumpies=this.game.add.group(),this.grumpyBullets=this.game.add.group(),this.score=0,this.maxScore=0,this.hudText=this.game.add.text(4,0,"OOPS",{fill:"#fff",font:FONT_OTHER,fontSize:32,fontStyle:"bold"}),this.hudText.shown=0,this.updateHudText(),this.game.time.events.loop(.05*Phaser.Timer.SECOND,this.updateShownScore,this),this.game.time.events.loop(.08*Phaser.Timer.SECOND,this.flickerUpdate,this),this.game.time.events.loop(1.5*Phaser.Timer.SECOND,this.grumpyShoot,this)},playMusic:function(e,t){"undefined"==typeof t&&(t=!0),this.music.current.stop(),e.play("",0,1,t),this.music.current=e},bakeMovements:function(){var e=this.world.width,t=this.world.height;Movement.grumpy1=Movement.bakeGrumpy1(e,t),Movement.grumpy2=Movement.bakeGrumpy2(e,t),Movement.grumpy3=Movement.bakeGrumpy3(e,t),Movement.boss1=Movement.bakeBoss1(e,t)},makeWave:function(e){switch(e){case 1:this.makeGrumpy1Subgroup(5,0);break;case 2:this.makeGrumpy2Subgroup(4,9);break;case 3:this.makeGrumpy1Subgroup(4,0),this.makeGrumpy3Subgroup(2);break;case 4:this.makeGrumpy1Subgroup(6,0),this.makeGrumpy2Subgroup(3,3),this.makeGrumpy2Subgroup(3,9,1);break;case 5:this.makeGrumpy1Subgroup(12,0),this.makeGrumpy2Subgroup(5,9),this.makeGrumpy3Subgroup(3),this.makeGrumpy3Subgroup(3,20);break;case 6:this.makeGrumpy1Subgroup(12,0),this.makeGrumpy2Subgroup(3,9),this.makeGrumpy3Subgroup(5);break;case 7:this.boss=this.createBoss1();break;case 8:this.makeGrumpy3Subgroup(2),this.makeGrumpy3Subgroup(2,20),this.makeGrumpy2Subgroup(4,3,2),this.makeGrumpy2Subgroup(8,9);break;case 9:this.makeGrumpy1Subgroup(12,0),this.makeGrumpy1Subgroup(12,1,4),this.makeGrumpy3Subgroup(3);break;case 10:this.makeGrumpy2Subgroup(8,0),this.makeGrumpy2Subgroup(4,1,4),this.makeGrumpy3Subgroup(5);break;case 11:this.makeGrumpy2Subgroup(4,0),this.makeGrumpy2Subgroup(4,4,2),this.makeGrumpy1Subgroup(8,0),this.makeGrumpy1Subgroup(8,4,1);break;case 12:this.makeGrumpy2Subgroup(4,4),this.makeGrumpy2Subgroup(4,8,2),this.makeGrumpy3Subgroup(8),this.makeGrumpy1Subgroup(8,8,1);break;case 13:this.makeGrumpy1Subgroup(18,0,20),this.makeGrumpy3Subgroup(1),this.makeGrumpy2Subgroup(8,9,20),this.makeGrumpy3Subgroup(12,30);break;case 14:this.boss=this.createBoss2();break;default:console.log("OOPS")}},makeGrumpy1Subgroup:function(e,t,s){"undefined"==typeof s&&(s=0);var i,a=48+t*this.ENEMY_SPACING,h=-((e+s)*this.ENEMY_SPACING);for(i=0;e>i;++i)this.grumpies.add(this.createGrumpy1(h+i*this.ENEMY_SPACING,a))},makeGrumpy2Subgroup:function(e,t,s){"undefined"==typeof s&&(s=0);var i,a=48+t*this.ENEMY_SPACING,h=-((e+s)*this.ENEMY_SPACING);for(i=0;e>i;++i)this.grumpies.add(this.createGrumpy2(a,h+i*this.ENEMY_SPACING))},makeGrumpy3Subgroup:function(e,t){"undefined"==typeof t&&(t=0);var s,i=48,a=-((e+t)*this.ENEMY_SPACING);for(s=0;e>s;++s)this.grumpies.add(this.createGrumpy3(i,a+s*this.ENEMY_SPACING))},createPlayer:function(e,t,s){var i=this.game.add.sprite(e,t,"sprites");return i.animations.add("left",[s+"Left"]),i.animations.add("main",[s]),i.animations.add("right",[s+"Right"]),i.animations.play("main"),this.initObject(i,3),i.body.collideWorldBounds=!0,i.health=3,i.healthEarned=0,i.flickerTimer=null,this.initShooter(i,.1*Phaser.Timer.SECOND),i.bullets=this.game.add.group(),i.events.onKilled.add(function(){this.waveText.text="GAME θVER",this.waveText.bringToTop(),this.waveText.visible=!0},this),i.body.setSize(12,8,1,1),i},setReloadTimer:function(e){this.game.time.events.add(e.reloadTime,function(){e.canShoot=!0})},createBoss:function(e,t,s,i,a){var h=this.createObject1(this.world.width/2,-128,3,e);return this.initEnemy(h,t,s,i),h.updateFunc=a,h.goons=this.game.add.group(),h.bossTick=0,h},createGrumpy:function(e,t,s,i,a,h){var r=[s+"A",s+"B"],o=this.createObject2(e,t,3,r);return this.initEnemy(o,i,a,h),o},initEnemy:function(e,t,s,i){e.moveState=-1,e.moveFunc=s,e.health=t,e.flickerTimer=null,e.events.onKilled.add(function(){this.addScore(i),this.sfx.destroy1.play()},this)},createBoss1:function(){return this.createBoss("boss1",300,Movement.boss1,1200,this.updateBoss1)},createBoss2:function(){return this.createBoss("boss2",500,Movement.boss1,3e3,this.updateBoss2)},updateBoss1:function(){var e=this.boss.health,t=this.boss.bossTick;100>e?t%20===0&&this.grumpyShootOne(this.boss):200>e?t%30===0&&this.grumpyShootOne(this.boss):t%45===0&&this.grumpyShootOne(this.boss)},updateBoss2:function(){var e=this.boss.health,t=this.boss.bossTick;100>e?t%12===0&&this.grumpyShootOne(this.boss):200>e?t%15===0&&this.grumpyShootOne(this.boss):300>e?t%18===0&&this.grumpyShootOne(this.boss):400>e?t%21===0&&this.grumpyShootOne(this.boss):t%24===0&&this.grumpyShootOne(this.boss)},createGrumpy1:function(e,t){return this.createGrumpy(e,t,"enemy1",4,Movement.grumpy1,60)},createGrumpy2:function(e,t){return this.createGrumpy(e,t,"enemy2",8,Movement.grumpy2,80)},createGrumpy3:function(e,t){return this.createGrumpy(e,t,"enemy3",3,Movement.grumpy3,80)},createBullet:function(e,t,s,i){var a=this.game.add.sprite(e,t,"sprites","bullet"+s);return this.initObject(a,i),a.checkWorldBounds=!0,a.outOfBoundsKill=!0,a},createObject1:function(e,t,s,i){var a=this.game.add.sprite(e,t,"sprites",i);return this.initObject(a,s),a},createObject2:function(e,t,s,i){var a=this.game.add.sprite(e,t,"sprites");return a.animations.add("main",i,5,!0),a.animations.play("main"),this.initObject(a,s),a},initObject:function(e,t){e.smoothed=!1,e.scale.set(t,t),e.anchor.set(.5,.5),this.game.physics.enable(e,Phaser.Physics.ARCADE)},initShooter:function(e,t){e.reloadTime=t,e.canShoot=!1,this.setReloadTimer(e)},update:function(){this.updateWave(),this.doCollision(),this.player.alive&&this.updatePlayer(),null!==this.boss&&(this.boss.alive?(this.boss.moveFunc(this.boss),this.boss.updateFunc.call(this),this.boss.bossTick=(this.boss.bossTick+1)%1e6):(this.boss.goons.destroy(),this.boss=null));this.world.width,this.world.height;this.grumpies.forEachAlive(function(e){e.moveFunc(e)},this),this.updateHudText()},updateWave:function(){if(!this.waveText.visible&&null===this.boss&&null===this.grumpies.getFirstAlive()){if(this.grumpyBullets.forEachAlive(function(e){e.kill()},null),this.grumpies.removeAll(!0),this.wave++,this.waveText.text=this.getWaveName(this.wave),this.waveText.bringToTop(),this.waveText.visible=!0,this.updateMusic(),this.wave>this.NUM_WAVES)return;this.game.time.events.add(2*Phaser.Timer.SECOND,function(){this.makeWave(this.wave),this.waveText.visible=!1},this)}},updateMusic:function(){1==this.wave&&this.playMusic(this.music.waves1),7==this.wave&&this.playMusic(this.music.boss),8==this.wave&&this.playMusic(this.music.waves2),14==this.wave&&this.playMusic(this.music.boss),15==this.wave&&this.playMusic(this.music.win,!1)},grumpyShoot:function(){this.grumpies.forEachAlive(this.grumpyShootOne,this)},grumpyShootOne:function(e){var t=this.getBulletForPool(this.grumpyBullets,e.x,e.y,"White",3);this.game.physics.arcade.velocityFromRotation(this.game.physics.arcade.angleBetween(e,this.player),200,t.body.velocity)},getWaveName:function(e){switch(e){case 1:return"WAVE θNE";case 2:return"WAVE TWθ";case 3:return"WAVE THREE";case 4:return"WAVE FθUR";case 5:return"WAVE FIVE";case 6:return"WAVE SIX";case 7:return"BθSS WAVE";case 8:return"WAVE EIGHT";case 9:return"WAVE NINE";case 10:return"WAVE TEN";case 11:return"WAVE ELEVEN";case 12:return"WAVE TWELVE";case 13:return"WAVE THIRTEEN";case 14:return"FINAL BθSS";case 15:return"YθU WθN!"}},addScore:function(e){this.score=Math.max(Math.min(this.score+e,9999999),0)},updateShownScore:function(){this.hudText.shown!==this.score&&(this.hudText.shown<this.score-100?(this.hudText.shown+=60,this.sfx.scoreup.play()):this.hudText.shown<this.score-10?(this.hudText.shown+=10,this.sfx.scoreup.play()):this.hudText.shown<this.score?(this.hudText.shown+=1,this.sfx.scoreup.play()):this.hudText.shown=this.score,this.hudText.shown>1e3*(this.player.healthEarned+1)&&(this.player.health+=1,this.player.healthEarned+=1,this.sfx.hullup.play()))},updateHudText:function(){this.hudText.text="Score: "+("       "+this.hudText.shown).slice(-7)+"    Hull: "+("  "+this.player.health).slice(-2)+"    Wave: "+("  "+Math.min(this.wave,this.NUM_WAVES)).slice(-2),this.hudText.bringToTop()},doCollision:function(){this.game.physics.arcade.overlap(this.boss,this.player.bullets,this.doCollisionBulletEnemy,null,this),this.game.physics.arcade.overlap(this.grumpies,this.player.bullets,this.doCollisionBulletEnemy,null,this),this.game.physics.arcade.overlap(this.player,this.grumpies,this.doCollisionPlayerGrumpy,null,this),this.game.physics.arcade.overlap(this.player,this.grumpyBullets,this.doCollisionPlayerBullet,null,this)},doCollisionBulletEnemy:function(e,t){t.kill(),e.damage(1),this.setDamaged(e,.5*Phaser.Timer.SECOND),this.addScore(1)},doCollisionPlayerGrumpy:function(e,t){null===this.player.flickerTimer&&this.badPlayerCollision()},doCollisionPlayerBullet:function(e,t){null===this.player.flickerTimer&&(t.kill(),this.badPlayerCollision())},badPlayerCollision:function(){this.sfx.damage1.play(),this.player.damage(1),this.setDamaged(this.player,Phaser.Timer.SECOND)},updatePlayer:function(){var e=3600,t=2/3,s=360,i=s*t,a=25,h=new Phaser.Point(this.pad.axis(Phaser.Gamepad.XBOX360_STICK_LEFT_X),this.pad.axis(Phaser.Gamepad.XBOX360_STICK_LEFT_Y));this.game.input.keyboard.isDown(Phaser.KeyCode.A)&&(h.x-=1),this.game.input.keyboard.isDown(Phaser.KeyCode.D)&&(h.x+=1),this.game.input.keyboard.isDown(Phaser.KeyCode.W)&&(h.y-=1),this.game.input.keyboard.isDown(Phaser.KeyCode.S)&&(h.y+=1),h.clamp(-1,1),h.getMagnitude()>1&&h.normalize();var r=e*h.x,o=e*t*h.y,u=this.calculateDrag(this.player.body.velocity.x,a),n=this.calculateDrag(this.player.body.velocity.y,a);if(this.player.body.acceleration.set(r,o),this.player.body.velocity.add(u,n),this.player.body.velocity.clampX(-s,s),this.player.body.velocity.clampY(-i,i),h.x<-.5?this.player.animations.play("left"):h.x<.5?this.player.animations.play("main"):this.player.animations.play("right"),!this.waveText.visible&&this.player.canShoot){var l=this.game.input.keyboard.isDown(Phaser.KeyCode.J),m=this.pad.isDown(Phaser.Gamepad.XBOX360_A);(l||m)&&this.playerShoot()}},playerShoot:function(){var e=this.getBulletForPool(this.player.bullets,this.player.x,this.player.top-1,"Green",2);e.body.velocity.set(0,-500),this.player.canShoot=!1,this.setReloadTimer(this.player),this.addScore(-1),this.sfx.shot3.play()},getBulletForPool:function(e,t,s,i,a){var h=e.getFirstDead(!1,t,s);return null===h&&(h=this.createBullet(t,s,i,a),e.add(h)),h},setDamaged:function(e,t){null!==e.flickerTimer&&(this.game.time.events.remove(e.flickerTimer),e.flickerTimer=null),e.flickerTimer=this.game.time.events.add(t,function(){this.flickerTimer=null},e)},calculateDrag:function(e,t){var s=0;return e>0?s=-Math.min(e,t):0>e&&(s=Math.min(-e,t)),s},rand:function(e){return Math.floor(Math.random()*e)},flickerUpdate:function(){this.flickerUpdateOne(this.player),null!==this.boss&&this.flickerUpdateOne(this.boss),this.grumpies.forEachAlive(this.flickerUpdateOne,this)},flickerUpdateOne:function(e){null!==e.flickerTimer&&1===e.alpha?e.alpha=.3:e.alpha=1}};
